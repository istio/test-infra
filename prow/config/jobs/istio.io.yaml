org: istio
repo: istio.io
support_release_branching: true
image: gcr.io/istio-testing/build-tools:master-2020-09-15T14-05-50

jobs:
  - name: lint
    command: [make, lint]

  - name: gencheck
    command: [make, gen-check]

  - name: doc.test.profile_default
    command: [entrypoint, prow/integ-suite-kind.sh, doc.test.profile_default]
    requirements: [kind]
    modifiers: [optional]

  - name: doc.test.profile_demo
    command: [entrypoint, prow/integ-suite-kind.sh, doc.test.profile_demo]
    requirements: [kind]
    modifiers: [optional]

  - name: doc.test.profile_none
    command: [entrypoint, prow/integ-suite-kind.sh, doc.test.profile_none]
    requirements: [kind]
    modifiers: [optional]
  
  - name: k8s-multicluster-tests
    command: [entrypoint, prow/integ-suite-kind.sh, doc.test.multicluster]
    requirements: [kind]
    env:
      - name: TOPOLOGY
        value: MULTICLUSTER

  - name: update-ref-docs-dry-run
    type: presubmit
    command:
    - ../test-infra/tools/automator/automator.sh
    - --org=istio
    - --repo=istio.io
    - --token-path=/etc/github-token/oauth
    - --cmd=make update_ref_docs
    - --dry-run
    requirements: [github]
    modifiers: [optional]
    repos: [istio/test-infra@master]

  - name: update-ref-docs
    disable_release_branching: true
    type: periodic
    cron: "0 2 * * *"  # every day at 02:00AM UTC
    command:
    - ./tools/automator/automator.sh
    - --org=istio
    - --repo=istio.io
    - "--title=Automator: update istio.io@$AUTOMATOR_SRC_BRANCH reference docs"
    - --labels=auto-merge,release-notes-none
    - --modifier=refdocs
    - --token-path=/etc/github-token/oauth
    - --cmd=make update_ref_docs
    requirements: [github]
    repos: [istio/test-infra@master]

resources:
  default:
    requests:
      memory: "3Gi"
      cpu: "5000m"
    limits:
      memory: "24Gi"
      cpu: "8000m"
  lint:
    requests:
      memory: "16Gi"
      cpu: "3000m"
    limits:
      memory: "24Gi"
      cpu: "5000m"
